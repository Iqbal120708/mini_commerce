{% extends "base.html" %} {% block script %}
<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
{% endblock script %} {% block content %} {% include "shop/header.html" %}
<main>
    <div class="w-[80%]">
        
    {% include "alert.html" %}
    </div>
    <form method="post" x-data="{ total: 0 }">
        {% csrf_token %} {% for cart in cart_list %}
        <section
            class="border-2 border-primary m-2 shadow rounded"
            :class="checked ? 'bg-blue-50' : ''"
            x-data="{ open : false, checked : false, qty : 1 , price : {{cart.product.price }}}"
        >
            <div class="flex items-center">
                <div>
                    <input
                        type="checkbox"
                        name="selected[]"
                        value="{{cart.id}}"
                        class="checkbox checkbox-primary mx-2"
                        x-model="checked"
                        @change="if (checked) {total += qty*price} else {total -= qty*price}"
                    />
                    <!--<input
                        type="hidden"
                        name="cart_{{cart.id}}"
                        value="{{cart.id}}"
                    /> -->
                </div>
                <img
                    class="w-32 h-32 object-cover"
                    src="{{ MEDIA_URL }}{{ cart.product.image.path|default:'no_image.png' }}"
                    alt="{{ cart.product.name }}"
                />
                <div class="w-full p-2">
                    <div>
                        <p class="font-bold my-1">{{ cart.product.name }}</p>
                        <p class="text-gray-600 text-sm">
                            Stock: {{ cart.product.stock }}
                        </p>
                        <p class="text-primary">Rp. {{ cart.product.price }}</p>
                    </div>
                    <div class="flex justify-end">
                        <div class="flex justify-end items-center">
                            <button
                                type="button"
                                class="btn btn-primary btn-sm btn-outline text-xl px-1 w-5 h-5"
                                @click="if (qty > 1) { qty--; if (checked) total -= price}"
                            >
                                -
                            </button>
                            <input
                                type="number"
                                class="rounded border border-blue-700 text-blue-700 text-center w-8 mx-1 h-5 focus:outline-0 focus:ring-1 focus:ring-blue-700"
                                min="1"
                                name="qty_{{cart.id}}"
                                x-model="qty"
                            />
                            <button
                                type="button"
                                class="btn btn-primary btn-sm btn-outline text-xl px-1 w-5 h-5"
                                @click="qty++; if (checked) total += price"
                            >
                                +
                            </button>
                        </div>
                        <button
                            type="button"
                            class="btn btn-ghost p-1 h-5 text-xl font-bold ml-2 rotate-90"
                            @click="open = !open"
                        >
                            >
                        </button>
                    </div>
                </div>
            </div>
            <div
                class="m-4"
                x-show="open"
                x-transition:enter="transition ease-out duration-500"
                x-transition:enter-start="opacity-0 transform -translate-y-2"
                x-transition:enter-end="opacity-100 transform translate-y-0"
                x-transition:leave="transition ease-in duration-300"
                x-transition:leave-start="opacity-100 transform translate-y-0"
                x-transition:leave-end="opacity-0 transform -translate-y-2"
            >
                <p class="text-gray-600 text-sm">{{ cart.product.desc }}</p>
            </div>
        </section>
        {% endfor %}
        <div class="fixed left-0 bottom-0 bg-gray-100 w-full p-2">
            <div class="flex justify-between items-center">
                <p
                    class="text-primary font-bold"
                    x-text="`Rp. ${total.toLocaleString('id-ID')}`"
                ></p>

                <button type="submit" class="btn btn-primary">Check out</button>
            </div>
        </div>
    </form>
</main>
{% endblock content %}
